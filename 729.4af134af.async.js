"use strict";(self.webpackChunk_quansitech_pallas_h5=self.webpackChunk_quansitech_pallas_h5||[]).push([[729],{729:function(P,m,_){_.r(m);var v=_(17061),o=_.n(v),E=_(42122),c=_.n(E),b=_(17156),p=_.n(b),f=_(86327);m.default={upload:function(){var n=p()(o()().mark(function l(a,i,e){var t,u,d,D,h,g,y,O,T;return o()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t=new FormData,u=new URLSearchParams(i),e&&u.append("hash_id",e),d=a.type,d){r.next=8;break}return r.next=7,f.Z.getFileType.start(a);case 7:d=r.sent;case 8:return u.append("vendor_type","tengxun_cos"),u.append("file_type",d),u.append("title",a.name),r.next=13,fetch(decodeURIComponent(u.toString()));case 13:return D=r.sent,r.next=16,D.json();case 16:if(h=r.sent,parseInt(h.status)!==2){r.next=19;break}return r.abrupt("return",{file_id:h.file_id,url:h.file_url});case 19:g=c()({"Content-type":d},h.params);for(y in g)t.append(y,g[y]);return t.append("file",a),r.next=24,fetch(h.url,{method:"POST",body:t});case 24:return O=r.sent,r.next=27,O.json();case 27:return T=r.sent,r.abrupt("return",T);case 29:case"end":return r.stop()}},l)}));function s(l,a,i){return n.apply(this,arguments)}return s}()}},86327:function(P,m,_){var v=_(17061),o=_.n(v),E=_(17156),c=_.n(E),b={getFileType:{fileToArrayBuffer:function(){var p=c()(o()().mark(function n(s,l){var a;return o()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=new FileReader,a.onload=function(t){if(typeof l=="function")return l(t.target.result)},a.readAsArrayBuffer(s);case 3:case"end":return e.stop()}},n)}));function f(n,s){return p.apply(this,arguments)}return f}(),getFileTypeViaHeader:function(f){for(var n=new Uint8Array(f),s=n.slice(0,4),l=n.slice(0,16),a="",i="",e,t=0;t<s.length;t++)a+=s[t].toString(16);for(var u=0;u<l.length;u++)i+=l[u].toString(16);switch(a){case"89504e47":e="image/png";break;case"47494638":e="image/gif";break;case"ffd8ffDB":case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":e="image/jpeg";break;case"00020":case"00018":case"00024":case"0001c":i.lastIndexOf("000")===22?e="image/heic":e="unknown";break;default:e="unknown";break}return e},start:function(){var p=c()(o()().mark(function n(s){var l,a;return o()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=this,a=new Promise(function(t){l.fileToArrayBuffer(s,function(u){var d=l.getFileTypeViaHeader(u);t(d)})}),e.abrupt("return",a);case 3:case"end":return e.stop()}},n,this)}));function f(n){return p.apply(this,arguments)}return f}()},getSuffix:function(f){var n=f.lastIndexOf("."),s="";return n!==-1&&(s=f.substring(n)),s}};m.Z=b}}]);
